version: 2

sources:
  - name: raw_customers
    description: "Raw customer data (seeded from CSV). Source of truth for B2C customers."
    database: dotted-hulling-477021-d2
    schema: "raw_staging"
    loader: "csv_seed"
    freshness:
      warn_after: {count: 24, period: hour}
      error_after: {count: 168, period: hour}
    loaded_at_field: _uploaded_at
    tables:
      - name: customers
        identifier: "customers_100"
        description: "Individual customer records"
        columns:
          - name: Index
            description: "Row number from source CSV (not PK)"
            tests:
              - not_null
          - name: Customer Id
            description: "Business key — unique across customers"
            tests:
              - unique
              - not_null
          - name: First Name
            tests: [not_null]
          - name: Last Name
            tests: [not_null]
          - name: Company
            description: "Employer or affiliated organization (nullable)"
          - name: City
            tests: [not_null]
          - name: Country
            tests: [not_null]
          - name: Phone 1
            description: "Primary contact number"
          - name: Phone 2
            description: "Secondary contact number"
          - name: Email
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_match_regex:
                  arguments:
                    regex: '^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$'
          - name: Subscription Date
            data_type: date
            description: "When customer subscribed (ISO 'YYYY-MM-DD')"
            tests:
              - not_null
          - name: Website
            description: "Personal or company website (nullable)"

  - name: raw_organizations
    description: "Raw B2B organization data (seeded from CSV). Used for account-based analytics."
    database: dotted-hulling-477021-d2
    schema: "raw_staging"
    loader: "csv_seed"
    freshness:
      warn_after: {count: 48, period: hour}
      error_after: {count: 336, period: hour}
    loaded_at_field: _uploaded_at
    tables:
      - name: organizations
        identifier: "organizations-100"
        description: "Business organization records"
        columns:
          - name: Index
            tests: [not_null]
          - name: Organization Id
            description: "Business key — unique across organizations"
            tests:
              - unique
              - not_null
          - name: Name
            tests: [not_null]
          - name: Website
          - name: Country
            tests: [not_null]
          - name: Description
          - name: Founded
            data_type: int
            description: "Year founded (e.g., 2010)"
            tests:
              - dbt_expectations.expect_column_values_to_be_between:
                  arguments:
                    min_value: 1800
                    max_value: "{{ modules.datetime.datetime.now().year }}"
          - name: Industry
          - name: Number of employees
            data_type: int
            tests:
              - dbt_expectations.expect_column_values_to_be_between:
                  arguments:
                    min_value: 1
                    max_value: 1000000
          - name: products

  - name: raw_products
    description: "Raw product catalog (seeded from CSV). Foundation for revenue & inventory analysis."
    database: dotted-hulling-477021-d2
    schema: "raw_staging"
    loader: "csv_seed"
    freshness:
      warn_after: {count: 24, period: hour}
      error_after: {count: 168, period: hour}
    loaded_at_field: _uploaded_at
    tables:
      - name: products
        identifier: "products-100"
        description: "Sellable product items"
        columns:
          - name: Index
            tests: [not_null]
          - name: Name
            tests: [not_null]
          - name: Description
          - name: Brand
            tests: [not_null]
          - name: Category
            tests: [not_null]
          - name: Price
            data_type: numeric
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_between:
                  arguments:
                    min_value: 0.01
                    max_value: 100000
          - name: Currency
            tests:
              - not_null
              - accepted_values:
                  arguments:
                    values: ['USD', 'EUR', 'GBP']
          - name: Stock
            data_type: int
            tests:
              - not_null
              - dbt_expectations.expect_column_values_to_be_between:
                  arguments:
                    min_value: 0
                    max_value: 1000000
          - name: EAN
            description: "European Article Number (13-digit barcode)"
            tests:
              - dbt_expectations.expect_column_values_to_match_regex:
                  arguments:
                    regex: '^[0-9]{13}$'
          - name: Color
          - name: Size
          - name: Availability
            tests:
              - accepted_values:
                  arguments:
                    values: ['In Stock', 'Out of Stock', 'Pre-order']
          - name: Internal ID
            description: "Internal SKU — may be duplicate if multi-variant"
            tests: [not_null]